<div metal:use-macro="layout">
	<div metal:fill-slot="header">
		<script type="text/javascript" src="${request.static_url('ptmscout:static/js/experiments.js')}" ></script>
		<link rel="stylesheet" type="text/css" href="${request.static_url('ptmscout:static/css/experiments.css')}" />
	</div>
    <div metal:fill-slot="content">
    	<table class = "experimenttable">
    		<tbody>
		   		<tr>
		   			<th>Experiment</th>
		   			<th>Description</th>
		   			<th>Author</th>
		   			<th>Journal Info</th>
		   			<th>Status</th>
		   			<th class="accesscontrol">Access Control</th>
		   		</tr>
		   		<tal:experiments tal:repeat="(i, experiment) enumerate(experiments)">
					<tr tal:attributes="class 'experiment' + (' even' if i % 2 == 0 else ' odd');" >
						<td><a tal:attributes="href request.application_url + '/experiments/' + str(experiment.id)" tal:content="experiment.name"></td>
						<td><a tal:attributes="href request.application_url + '/experiments/' + str(experiment.id)" tal:content="experiment.description"></a></td>
						<td><a tal:attributes="href request.application_url + '/experiments/' + str(experiment.id)" tal:content="experiment.author"></a></td>
						<td class="citation" tal:content="experiment.getCitationString()"></td>
						<td>
                            <div class="status">
                                <div tal:condition="experiment.status == 'loading'" tal:content="experiment.status + ': ' + experiment.loading_stage"></div>
                                <div tal:condition="experiment.status != 'loading'" tal:content="experiment.status"></div>
                                <a tal:condition="experiment.status == 'error'" tal:attributes="href '%s/upload/%d/retry' % (request.application_url, sessions[experiment.id])">retry</a>
                            </div>
                            <div class="progress" tal:condition="experiment.status == 'loading'" tal:content="str(experiment.progress) +  ' / ' + str(experiment.max_progress)"></div>
						</td>
						<td class="accesscontrol" tal:condition="experiment.public == 0">
							<table>
								<tr>
									<td>
										<form tal:attributes="id 'publish'+str(experiment.id);action request.application_url + '/account/experiments/' + str(experiment.id) + '/publish'" method="link">											
											<input type = "submit" value="Publish" />
										</form>
									</td>
									<td>
										<form tal:attributes="id 'share'+str(experiment.id);action request.application_url + '/account/experiments/' + str(experiment.id) + '/share'" method="link">
											<input type = "submit" value="Change Permissions" />
										</form>
									</td>
								</tr>
							</table>
						</td>
						<td class="accesscontrol" tal:condition="experiment.public == 1">
							<form tal:attributes="id 'unpublish'+str(experiment.id);action request.application_url + '/account/experiments/' + str(experiment.id) + '/unpublish'" method="link">
								<input type = "submit" value="Make Private" />
							</form>
						</td>
					</tr>
				</tal:experiments>
				
				<tal:empty tal:condition = "len(in_process) > 0">
	    			<tr>
	    				<th colspan="6">Experiments awaiting configuration and confirmation:</th>
	    			</tr>
					<tal:experiments tal:repeat="(i, experiment) enumerate(in_process)">
						<tr tal:attributes="class 'experiment' + (' even' if i % 2 == 0 else ' odd');" >
							<td tal:content="experiment.name"></td>
							<td tal:content="experiment.description"></td>
							<td tal:content="experiment.author"></td>
							<td class="citation" tal:content="experiment.getCitationString()"></td>
							<td>
	                            <div class="status"><a tal:attributes="href '%s/upload/%d' % (request.application_url, sessions[experiment.id])">continue upload</a></div>
	   						</td>
							<td class="accesscontrol"></td>
						</tr>
					</tal:experiments>
				</tal:empty>
			</tbody>
		</table>
		    	
    </div>
</div>
