#!/usr/bin/python
import cgi
import cgitb;cgitb.enable()
print "Content-Type: application/octet-stream\n"
import sys
import MySQLdb
from pathname import *
db = MySQLdb.connect(user= "%s"%user, passwd="%s"%mysql, db="%s"%database)
c=db.cursor()

sys.path.append(path+"includes")
from peptideFunctions import *
form = cgi.FieldStorage()
clusterDict = {}
reverseClusterDict = {}
for item in form.keys():
    key = item.replace('ids','')
    val = form.getvalue(item,'').split(':')
    clusterDict[key]=val
    for ms in val: 
	if ms in reverseClusterDict.keys():
		reverseClusterDict[ms].append(key)
	else:
		reverseClusterDict[ms]=[key]
		
print "MS_id\tcluster:1\tsites\n"
for item in reverseClusterDict.keys():
    sitestring = getSiteString(item,c)
    # item is the msid, use this to get acc_<sitetype><sitenumber>
    vals = reverseClusterDict[item]
    for val in vals:
        print item+'\t'+val+'\t'+sitestring+'\n'

